version: '3.8'

services:
  trading-bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: trading-bot
    restart: unless-stopped
    ports:
      - "9090:9090"
    volumes:
      - trading-data:/app/data
    environment:
      - BINANCE_API_KEY=${BINANCE_API_KEY}
      - BINANCE_API_SECRET=${BINANCE_API_SECRET}
      - BINANCE_TESTNET=${BINANCE_TESTNET:-true}
      - TRADING_PAIR=${TRADING_PAIR:-BTCUSDT}
      - BASE_ASSET=${BASE_ASSET:-BTC}
      - QUOTE_ASSET=${QUOTE_ASSET:-USDT}
      - GRID_UPPER=${GRID_UPPER:-45000}
      - GRID_LOWER=${GRID_LOWER:-40000}
      - GRID_COUNT=${GRID_COUNT:-10}
      - GRID_AMOUNT=${GRID_AMOUNT:-0.001}
      - GRID_TYPE=${GRID_TYPE:-arithmetic}
      - SIMULATION_MODE=${SIMULATION_MODE:-true}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - SERVER_PORT=9090
      - COGNITO_USER_POOL_ID=${COGNITO_USER_POOL_ID}
      - COGNITO_CLIENT_ID=${COGNITO_CLIENT_ID}
      - COGNITO_REGION=${COGNITO_REGION:-us-east-1}
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:9090/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  trading-data:
    name: trading-bot-data
